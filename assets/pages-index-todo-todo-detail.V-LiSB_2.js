var be=Object.defineProperty,ge=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;var G=(p,c,d)=>c in p?be(p,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):p[c]=d,H=(p,c)=>{for(var d in c||(c={}))he.call(c,d)&&G(p,d,c[d]);if(M)for(var d of M(c))Te.call(c,d)&&G(p,d,c[d]);return p},Q=(p,c)=>ge(p,ke(c));var L=(p,c,d)=>new Promise((S,y)=>{var v=_=>{try{b(d.next(_))}catch(x){y(x)}},T=_=>{try{b(d.throw(_))}catch(x){y(x)}},b=_=>_.done?S(_.value):Promise.resolve(_.value).then(v,T);b((d=d.apply(p,c)).next())});import{d as xe,u as Ve,r as f,x as Ne,Q as Ie,a as w,w as e,b as q,e as g,f as k,_ as Ce,a5 as Ue,o as m,g as a,i as De,j as h,l as r,k as s,t as i,z as Le,K as F,y as C,R as N,M as R,a6 as Oe,a2 as J,m as O,O as Se,n as W,p as Be}from"./index-PW8lkL3M.js";import{_ as Pe,a as je}from"./wd-radio-group.BWRM1tDb.js";import{a as Fe,_ as Re}from"./wd-textarea.BSHhK-Vk.js";import{_ as $e}from"./wd-tag.Dk7KF4rd.js";import{_ as ze,a as Ee}from"./wd-steps.DgMU_9Px.js";import{B as X}from"./bottomBtn.C75zWmYf.js";import{T as Ae}from"./TopHeader.CoiZ0Ai5.js";import{c as Ke,u as Me,d as Y,f as Ge,j as He,h as Qe}from"./jdwl.DcTopnLo.js";import"./useChildren.DLyJo28_.js";import"./vue-query.DoLthAjK.js";const qe=xe({__name:"todo-detail",setup(p){const c=Ve(),d=f(c.userInfo.channelName),S=f(c.userInfo.user.nickName),y=f({}),v=f("1"),T=f(""),b=f(""),_=f(!1),x=f([]),B=f([]),$=f([]),U=f("my"),V=f(""),I=f(""),z=f([]),E=f([]);Ne(n=>{U.value=n.type,ae(),Z(),Ke({params:{processKey:n.procInsId}}).then(o=>{o.code===200&&(y.value=o.data,V.value=o.data.approveChannelName)}),getTeamOptions()}),Ie([()=>V.value,()=>I.value],n=>L(this,null,function*(){if(n[0]){const o=yield Y({params:{channelName:n[0]}});E.value=o.rows}if(n[1]){const o=yield Qe({params:{teamName:n[0],esopArea:n[1],orderType:"1"}});x.value=o.rows}}));function Z(){return L(this,null,function*(){const n=yield Me({params:{dictType:"jdwl_need_type"}});$.value=n.data})}function ee(n){var t;const o=(t=$.value)==null?void 0:t.find(u=>u.dictValue===n);return o?o.dictLabel:n}function ae(){return L(this,null,function*(){const n=yield Y({params:{channelName:""}});z.value=n.rows})}function te(){if(!v.value){O({title:"请选择处理方式",icon:"none"});return}if(!T.value.trim()){O({title:"请输入处理说明",icon:"none"});return}if(v.value==="2"&&!b.value){O({title:"请选择转派人员",icon:"none"});return}se()}function se(){Se({title:"提交中..."});const n=Q(H({},y.value),{passCode:v.value,comment:T.value,approveUserId:b.value});Ge({body:n}).then(o=>{o.code===200&&(O({title:"提交成功",icon:"success"}),setTimeout(()=>{W({url:"/pages-index/todo/todo"})},1500))})}function A(){_.value=!0,He({params:{procInsId:y.value.processKey,taskId:y.value.taskId}}).then(n=>{n.code===200&&(B.value=n.data.historyProcNodeList)})}function le(n){switch(n){case"1":return"通过";case"2":return"退回";case"3":return"驳回";case"4":return"委派";case"5":return"转办";case"6":return"终止";case"7":return"撤回";default:return"-"}}function oe(n){switch(n){case"1":return"success";case"2":return"warning";case"3":return"danger";case"4":return"primary";case"5":return"success";case"6":return"danger";case"7":return"info";default:return"info"}}function ne(){switch(v.value){case"onsite":return"请输入通过意见";case"door":return"请输入转派原因及处理意见";case"reject":return"请输入驳回原因";default:return"请输入处理说明"}}function ue(){W({url:"/pages-index/todo/todo?type=done"})}return(n,o)=>{const t=De,u=Le,P=g(k("wd-radio"),Pe),re=g(k("wd-radio-group"),je),ce=g(k("wd-textarea"),Fe),j=g(k("wd-picker"),Re),de=g(k("wd-icon"),Ce),K=g(k("wd-tag"),$e),ie=g(k("wd-step"),ze),fe=g(k("wd-steps"),Ee),_e=Oe,me=g(k("wd-popup"),Ue),pe=q("layout-default-uni"),ye=q("global-ku-root");return m(),w(ye,null,{default:e(()=>[a(pe,null,{default:e(()=>[a(t,{class:"todo-detail-page min-h-screen bg-[#f5f5f5]"},{default:e(()=>[a(Ae,{title:r(d),subtitle:r(S)},null,8,["title","subtitle"]),a(t,{class:"content-container"},{default:e(()=>[a(t,{class:"info-section"},{default:e(()=>[a(t,{class:"info-title"},{default:e(()=>[s(i(ee(r(y).needType)),1)]),_:1}),a(t,{class:"customer-info"},{default:e(()=>[a(t,{class:"info-row"},{default:e(()=>[a(u,{class:"info-label"},{default:e(()=>[s("客户姓名：")]),_:1}),a(u,{class:"info-value"},{default:e(()=>[s(i(r(y).customerName),1)]),_:1})]),_:1}),a(t,{class:"info-row"},{default:e(()=>[a(u,{class:"info-label"},{default:e(()=>[s("客户电话：")]),_:1}),a(u,{class:"info-value"},{default:e(()=>[s(i(r(y).customerPhone),1)]),_:1})]),_:1}),a(t,{class:"info-row"},{default:e(()=>[a(u,{class:"info-label"},{default:e(()=>[s("所在地址：")]),_:1}),a(u,{class:"info-value"},{default:e(()=>[s(i(r(y).address),1)]),_:1})]),_:1}),a(t,{class:"info-row"},{default:e(()=>[a(u,{class:"info-label"},{default:e(()=>[s("提交时间：")]),_:1}),a(u,{class:"info-value"},{default:e(()=>[s(i(r(y).createTime),1)]),_:1})]),_:1})]),_:1})]),_:1}),r(U)==="my"?(m(),w(t,{key:0,class:"process-detail-card"},{default:e(()=>[a(t,{class:"form-row",style:{"align-items":"center"}},{default:e(()=>[a(t,{class:"form-label"},{default:e(()=>[C("span",{style:{color:"red"}},"*"),s("处理方式： ")]),_:1}),a(t,{class:"form-content"},{default:e(()=>[a(re,{modelValue:r(v),"onUpdate:modelValue":o[0]||(o[0]=l=>N(v)?v.value=l:null),inline:"",shape:"dot"},{default:e(()=>[a(P,{value:"1"},{default:e(()=>[s(" 通过 ")]),_:1}),a(P,{value:"2"},{default:e(()=>[s(" 转派 ")]),_:1}),a(P,{value:"0"},{default:e(()=>[s(" 驳回 ")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(t,{class:"form-row"},{default:e(()=>[a(t,{class:"form-label"},{default:e(()=>[C("span",{style:{color:"red"}},"*"),s("处理说明： ")]),_:1}),a(t,{class:"form-content"},{default:e(()=>[a(ce,{modelValue:r(T),"onUpdate:modelValue":o[1]||(o[1]=l=>N(T)?T.value=l:null),placeholder:ne(),rows:3,maxlength:500,"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),r(v)==="2"?(m(),F(R,{key:0},[a(t,{class:"form-row"},{default:e(()=>[a(t,{class:"form-label"},{default:e(()=>[C("span",{style:{color:"red"}},"*"),s("选择装维团队 ")]),_:1}),a(t,{class:"form-content"},{default:e(()=>[a(j,{modelValue:r(V),"onUpdate:modelValue":o[2]||(o[2]=l=>N(V)?V.value=l:null),columns:r(z),"value-key":"resultField","label-key":"resultField",placeholder:"请选择装维团队",disabled:""},null,8,["modelValue","columns"])]),_:1})]),_:1}),a(t,{class:"form-row"},{default:e(()=>[a(t,{class:"form-label"},{default:e(()=>[C("span",{style:{color:"red"}},"*"),s("选择sop小区 ")]),_:1}),a(t,{class:"form-content"},{default:e(()=>[a(j,{modelValue:r(I),"onUpdate:modelValue":o[3]||(o[3]=l=>N(I)?I.value=l:null),columns:r(E),placeholder:"请选择sop小区","label-key":"resultField","value-key":"resultField",disabled:!r(V)},null,8,["modelValue","columns","disabled"])]),_:1})]),_:1}),a(t,{class:"form-row"},{default:e(()=>[a(t,{class:"form-label"},{default:e(()=>[C("span",{style:{color:"red"}},"*"),s("选择装维人员 ")]),_:1}),a(t,{class:"form-content"},{default:e(()=>[a(j,{modelValue:r(b),"onUpdate:modelValue":o[4]||(o[4]=l=>N(b)?b.value=l:null),columns:r(x),"value-key":"userId","label-key":"nickName",placeholder:"请选择装维人员",disabled:!r(I)},null,8,["modelValue","columns","disabled"])]),_:1})]),_:1})],64)):h("",!0)]),_:1})):h("",!0)]),_:1}),r(U)==="my"?(m(),w(X,{key:0,"submit-text":"提交","save-draft-text":"流转记录",onSubmit:te,onSaveDraft:A})):h("",!0),r(U)==="done"?(m(),w(X,{key:1,"submit-text":"返回","save-draft-text":"流转记录",onSubmit:ue,onSaveDraft:A})):h("",!0),a(me,{modelValue:r(_),"onUpdate:modelValue":o[6]||(o[6]=l=>N(_)?_.value=l:null),position:"bottom","custom-style":"height: 70%; border-radius: 20rpx 20rpx 0 0;"},{default:e(()=>[a(t,{class:"process-popup"},{default:e(()=>[a(t,{class:"popup-header"},{default:e(()=>[a(u,{class:"popup-title"},{default:e(()=>[s("流转记录")]),_:1}),a(de,{name:"close",size:"20px",onClick:o[5]||(o[5]=l=>_.value=!1)})]),_:1}),a(_e,{"scroll-y":"",class:"popup-content"},{default:e(()=>[a(fe,{active:r(B).length-1,vertical:"","custom-class":"p-5"},{default:e(()=>[(m(!0),F(R,null,J(r(B),(l,ve)=>(m(),w(ie,{key:ve,title:l.activityName,status:l.endTime?"finished":"process"},{description:e(()=>[a(t,{class:"step-content"},{default:e(()=>[l.activityType==="startEvent"?(m(),w(t,{key:0,class:"step-card"},{default:e(()=>[a(u,null,{default:e(()=>[s(i(l.assigneeName)+" 在 "+i(l.createTime)+" 发起流程",1)]),_:2},1024)]),_:2},1024)):h("",!0),l.activityType==="userTask"?(m(),w(t,{key:1,class:"step-card"},{default:e(()=>[a(t,{class:"card-row"},{default:e(()=>[a(u,{class:"label"},{default:e(()=>[s("实际办理：")]),_:1}),a(u,null,{default:e(()=>[s(i(l.assigneeName||"-"),1)]),_:2},1024)]),_:2},1024),a(t,{class:"card-row"},{default:e(()=>[a(u,{class:"label"},{default:e(()=>[s("候选办理：")]),_:1}),a(u,null,{default:e(()=>[s(i(l.candidate||"-"),1)]),_:2},1024)]),_:2},1024),a(t,{class:"card-row"},{default:e(()=>[a(u,{class:"label"},{default:e(()=>[s("接收时间：")]),_:1}),a(u,null,{default:e(()=>[s(i(l.createTime||"-"),1)]),_:2},1024)]),_:2},1024),a(t,{class:"card-row"},{default:e(()=>[a(u,{class:"label"},{default:e(()=>[s("办结时间：")]),_:1}),a(u,null,{default:e(()=>[s(i(l.endTime||"-"),1)]),_:2},1024)]),_:2},1024),a(t,{class:"card-row"},{default:e(()=>[a(u,{class:"label"},{default:e(()=>[s("耗时：")]),_:1}),a(u,null,{default:e(()=>[s(i(l.duration||"-"),1)]),_:2},1024)]),_:2},1024),l.commentList&&l.commentList.length>0?(m(),w(t,{key:0,class:"comments"},{default:e(()=>[(m(!0),F(R,null,J(l.commentList,(D,we)=>(m(),w(t,{key:we,class:"comment-item"},{default:e(()=>[a(t,{class:"comment-header"},{default:e(()=>[a(K,{type:oe(D.type),size:"small"},{default:e(()=>[s(i(le(D.type)),1)]),_:2},1032,["type"]),a(K,{type:"primary",size:"small"},{default:e(()=>[s(i(D.time),1)]),_:2},1024)]),_:2},1024),a(u,{class:"comment-text"},{default:e(()=>[s(i(D.fullMessage),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)):h("",!0)]),_:2},1024)):h("",!0),l.activityType==="endEvent"?(m(),w(t,{key:2,class:"step-card"},{default:e(()=>[a(u,null,{default:e(()=>[s(i(l.createTime)+" 结束流程",1)]),_:2},1024)]),_:2},1024)):h("",!0)]),_:2},1024)]),_:2},1032,["title","status"]))),128))]),_:1},8,["active"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}}),na=Be(qe,[["__scopeId","data-v-efb6418a"]]);export{na as default};
