var F=(m,_,c)=>new Promise((r,l)=>{var o=e=>{try{t(c.next(e))}catch(a){l(a)}},d=e=>{try{t(c.throw(e))}catch(a){l(a)}},t=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,d);t((c=c.apply(m,_)).next())});import{r as h,C as A,D as L,d as $,u as T,q as N,s as P,c as V,a as g,w as s,b as S,m as b,o as x,g as f,i as j,l as k,h as q,j as B,k as y,t as I,A as D,n as C,L as U,E as G,p as O}from"./index-PW8lkL3M.js";function Y(m,_={},c={},r){const l=h(!1),o=h(!1),d=h(),t=h(0),{count:e=1,sizeType:a=["original","compressed"],sourceType:i=["album","camera"],maxSize:u=10,onProgress:n,onSuccess:p,onError:v,onComplete:z}=c;return{loading:l,error:o,data:d,progress:t,run:()=>{A({count:e,sizeType:a,sourceType:i,success:w=>{l.value=!0,t.value=0,J({url:m,tempFilePath:w.tempFilePaths[0],formData:_,data:d,error:o,loading:l,progress:t,onProgress:n,onSuccess:p,onError:v,onComplete:z})},fail:w=>{o.value=!0,v==null||v(w)}})}}}function J({url:m,tempFilePath:_,formData:c,data:r,error:l,loading:o,progress:d,onProgress:t,onSuccess:e,onError:a,onComplete:i}){try{L({url:m,filePath:_,name:"file",formData:c,header:{},success:n=>{try{const{data:p}=JSON.parse(n.data);r.value=p,e==null||e(p)}catch(p){l.value=!0,a==null||a(new Error("上传响应解析失败"))}},fail:n=>{l.value=!0,a==null||a(n)},complete:()=>{o.value=!1,i==null||i()}}).onProgressUpdate(n=>{d.value=n.progress,t==null||t(n.progress)})}catch(u){l.value=!0,o.value=!1,a==null||a(new Error("创建上传任务失败"))}}const M=$({__name:"me",setup(m){const _=T(),c=N(),{userInfo:r}=P(_),l=V(()=>{var e,a,i;return(i=(a=(e=r.value)==null?void 0:e.roles)==null?void 0:a.includes("jdwl_yytry"))!=null?i:!1}),{run:o}=Y("/file/uploadFile",{},{onSuccess:e=>{T().setUserAvatar(e.fileUrl),b({title:"头像上传成功",icon:"success"})}});function d(){return F(this,null,function*(){C({url:U})})}function t(){G({title:"提示",content:"确定要退出登录吗？",success:e=>{e.confirm&&(N().logout(),localStorage.removeItem("user"),localStorage.removeItem("token"),b({title:"退出登录成功",icon:"success"}),C({url:U}))}})}return(e,a)=>{const i=q,u=j,n=D,p=S("layout-default-uni"),v=S("global-ku-root");return x(),g(v,null,{default:s(()=>[f(p,null,{default:s(()=>[f(u,{class:"profile-container"},{default:s(()=>[f(u,{class:"user-info-section"},{default:s(()=>[f(u,{class:"avatar-wrapper",onClick:k(o)},{default:s(()=>[f(i,{src:k(T)().userInfo.avatar,mode:"scaleToFill",class:"h-full w-full"},null,8,["src"])]),_:1},8,["onClick"]),f(u,{class:"user-details"},{default:s(()=>[f(u,{class:"username"},{default:s(()=>[y(I(k(r).user.nickName),1)]),_:1}),f(u,{class:"username",style:{"font-size":"26rpx"}},{default:s(()=>[y(" 手机号："+I(k(r).user.phonenumber),1)]),_:1}),l.value?(x(),g(u,{key:0,class:"username",style:{"font-size":"26rpx"}},{default:s(()=>[y(" 营业厅："+I(k(r).user.channelName),1)]),_:1})):B("",!0)]),_:1})]),_:1}),f(u,{class:"mt-20 px-3"},{default:s(()=>[f(u,{class:"m-auto w-160px text-center"},{default:s(()=>[k(c).tokenInfo.token?(x(),g(n,{key:0,type:"warn",class:"w-full",onClick:t},{default:s(()=>[y(" 退出登录 ")]),_:1})):(x(),g(n,{key:1,type:"primary",class:"w-full",onClick:d},{default:s(()=>[y(" 登录 ")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Q=O(M,[["__scopeId","data-v-55e86da8"]]);export{Q as default};
